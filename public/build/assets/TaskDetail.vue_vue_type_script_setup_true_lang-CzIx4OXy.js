import{o as u,c as p,b as t,d as R,t as l,n as tt,m as k,g as o,F as q,z,f as N,r as v,T as A,Q as ft,p as gt,y as E,J as kt,k as y,j as G,w as m,h as i,O as ht,i as yt,v as xt}from"./app-fd2yWfTJ.js";import{C as wt}from"./component-Cmof9OIU.js";import{_ as $t}from"./TaskSubDetail.vue_vue_type_script_setup_true_lang-D8_QPZS_.js";import{e as St,_ as Ct}from"./SubtaskDetail.vue_vue_type_script_setup_true_lang-CTUh1ZFy.js";import{I as H}from"./icon-x-ve0obKwg.js";import{I as Tt,a as J}from"./icon-users-Brc9g_A0.js";import{_ as Vt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as It,g as Dt}from"./TaskMessage.vue_vue_type_script_setup_true_lang-Bt3C96q5.js";import{_ as et}from"./UserInfo.vue_vue_type_script_setup_true_lang-Dwq6B2TV.js";import{_ as V}from"./InputError-BXOsc7Y5.js";import{_ as Mt}from"./FileIcon.vue_vue_type_script_setup_true_lang-CMAyjmR7.js";import{M as Q}from"./vue3-multiselect.umd.min-CbyIACKa.js";import{Y as X,h as U,_ as K,G as W,S as Z}from"./transition-B07g8Rew.js";const jt={},Ft={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ut(r,g){return u(),p("svg",Ft,g[0]||(g[0]=[t("circle",{opacity:"0.5",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"1.5"},null,-1),t("path",{d:"M12 8V12L14.5 14.5",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const st=Vt(jt,[["render",Ut]]),Bt=R({__name:"TagComponent",props:{color:{type:String,default:""},slug:{type:String,required:!0}},setup(r){return(g,b)=>(u(),p("span",{class:tt(["rounded-full px-2 text-sm font-bold py-1",{"bg-dark-light text-dark":r.color==="","text-white bg-warning":r.color==="warning","text-white bg-danger":r.color==="danger","text-white bg-info":r.color==="info","text-white bg-success":r.color==="success","text-white bg-primary":r.color==="primary","text-white bg-secondary":r.color==="secondary","text-white bg-light":r.color==="light","text-white bg-dark":r.color==="dark","text-white bg-white":r.color==="white"}])},l(g.$t(`${r.slug}`)),3))}}),Lt={class:"ltr:mr-2 rtl:ml-2"},At={class:"flex gap-2 font-bold italic mt-2 text-sm items-center text-dark"},Et={class:"flex flex-wrap mt-1 gap-1"},Ht=R({__name:"SubtaskComponent",props:{sub_task:{type:Object,required:!0}},emits:["updateSubTask"],setup(r,{emit:g}){const b=g;return(_,n)=>(u(),p("div",{class:tt(["p-3 mb-3 rounded border",{"text-success bg-success-light border-success":r.sub_task.status==="done"," text-secondary bg-secondary-light border-secondary":r.sub_task.status!=="done"}])},[t("div",{class:"ltr:pr-2 rtl:pl-2 cursor-pointer",onClick:n[0]||(n[0]=h=>b("updateSubTask",r.sub_task))},[t("strong",Lt,l(_.$t(r.sub_task.status)),1),k(" "+l(r.sub_task.title),1)]),o(et,{userData:r.sub_task.assignee},null,8,["userData"]),t("div",At,[o(st),k(" "+l(r.sub_task.due_date),1)]),t("div",Et,[(u(!0),p(q,null,z(r.sub_task.tags,(h,I)=>(u(),N(Bt,{key:I,slug:h.slug,color:h.color},null,8,["slug","color"]))),128))])],2))}}),qt={key:0,class:"bg-white dark:border-[#1b2e4b] dark:bg-[#191e3a] dark:shadow-none"},zt={class:"grid grid-cols-3 gap-1"},Nt={class:"col-span-2"},Rt={class:"relative"},Yt={class:""},Ot={class:"p-0 w-full text-black dark:text-white-dark"},Pt={class:"text-xl font-medium dark:bg-[#121c2c] py-1 pr-[50px]"},Gt={class:"text-[#888ea8] mb-5"},Jt={class:"uppercase font-bold"},Qt={class:"flex mb-5 gap-x-8"},Xt={key:0,class:"text-sm font-bold"},Kt={key:1},Wt={class:"col-span-1 flex items-center gap-x-2 text-sm font-bold"},Zt={key:0,class:"relative inline-flex align-middle my-2 gap-5"},te={class:"mb-5 flex gap-x-10"},ee=["disabled"],se={class:"flex-1"},ae={class:"mb-5"},oe={class:"flex justify-between"},le={for:"",class:"uppercase text-primary"},ne=["disabled"],ie={key:0},re={class:"flex justify-end mt-1 gap-x-5"},de={key:1,class:"pl-5"},ue=["innerHTML"],ce={class:"mb-5"},pe={for:"",class:"uppercase text-primary"},me={class:"flex"},_e={class:"bg-[#eee] gap-x-4 p-1 flex justify-center items-center ltr:rounded-l-md rtl:rounded-r-md px-3 font-semibold border ltr:border-r-0 rtl:border-l-0 border-[#e0e6ed] dark:border-[#17263c] dark:bg-[#1b2e4b]"},ve=["disabled"],be={key:0,class:"space-y-2 my-2"},fe={class:"w-full h-1 bg-[#ebedf2] dark:bg-dark/40 rounded-full flex"},ge={class:"grid lg:grid-cols-2 grid-cols-1 gap-x-5"},ke=["href"],he=["onClick"],ye={class:"mb-5"},xe={class:"uppercase text-dark text-xl"},we=["disabled"],$e={key:1},Se={class:"flex justify-end mt-1 gap-x-3"},Ce={key:2,class:"pl-5 mt-2"},Te=["innerHTML"],Ve={class:"mb-5"},Ie={for:"",class:"uppercase text-dark text-xl mb-5"},De={key:0},Me=["disabled"],je={class:"mb-5"},Fe={class:"col-span-1"},Ue={class:"fixed inset-0 overflow-y-auto"},Be={class:"flex min-h-full items-center justify-center"},Le={class:"p-5"},Ae={class:"mb-4"},Ee={for:""},He={class:"relative"},qe={class:"absolute ltr:left-3 rtl:right-3 top-1/2 -translate-y-1/2 dark:text-white-dark"},ze={class:"mb-4"},Ne={for:""},Re={class:"mb-4"},Ye={for:""},Oe={class:"relative"},Pe={class:"absolute ltr:left-3 rtl:right-3 top-1/2 -translate-y-1/2 dark:text-white-dark"},Ge={class:"flex items-center gap-2"},Je=["src"],Qe={class:"option__desc"},Xe={class:"option__title"},Ke={class:"flex gap-2 items-center"},We=["src"],Ze={class:"option__desc"},ts={class:"option__title"},es={class:"mb-4"},ss={for:""},as={class:"relative"},os={class:"absolute ltr:left-3 rtl:right-3 top-1/2 -translate-y-1/2 dark:text-white-dark"},ls={class:"flex items-center gap-2"},ns=["src"],is={class:"option__desc"},rs={class:"option__title"},ds={class:"flex gap-2 items-center"},us=["src"],cs={class:"option__desc"},ps={class:"option__title"},ms={class:"mb-4"},_s={for:""},vs={class:"flex gap-x-4"},bs={type:"submit",class:"btn btn-primary w-full"},fs={class:"fixed inset-0 overflow-y-auto"},gs={class:"flex min-h-full items-center justify-center px-4 py-8"},ks={key:1,class:"absolute inset-0 flex justify-center items-center"},Us=R({__name:"TaskDetail",props:{taskId:{type:Number,required:!0},assignees:{type:Array,required:!0},assigners:{type:Array,required:!0}},emits:["close","scrollToBottom"],setup(r,{emit:g}){const b=v(St),_=r,n=v(),h=v([]),I=v(0),Y=g,f=A({file:{},task_id:_.taskId}),at=()=>{Y("scrollToBottom")},ot=v({position:"auto left",enableTime:!0,dateFormat:"Y-m-d H:i"}),D=ft(),x=v(!1),w=v(!1),$=v(!1),M=v(!1),S=v([]),d=A({title:"",description:"",due_date:"",result:"",status:"",assign_to:null,started_at:"",assignee:{},assigner:{},assignee_id:0,assigner_id:0,attachments:[],created_by:0}),c=A({title:"",description:"",due_date:"",assign_to:null,created_by:D.props.auth.user.id,task_id:_.taskId,assignee:{},assigner:{},assignee_id:0,assigner_id:0}),O=()=>{c.reset(),c.created_by=D.props.auth.user.id,c.task_id=_.taskId},lt=()=>{const a=new Date,e=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`;d.started_at=e,d.status="doing",d.post(route("task.start",_.taskId),{onSuccess:()=>{d.assignee_id===D.props.auth.user.id&&(n.value.started_at=e,d.status="")}})},nt=()=>{d.status="done",d.post(route("task.mark-as-done",_.taskId),{onSuccess:()=>{d.status=""}})},it=async()=>{n.value.result&&n.value.result!==""?(d.result=n.value.result,d.post(route("task.update-result",_.taskId),{onSuccess:()=>{w.value=!1}})):P()},P=()=>{w.value=!1,d.clearErrors()},rt=()=>{f.post(route("task-attachment.upload"),{onSuccess:()=>{f.clearErrors();const a=D.props.flash_data.file;S.value.push({id:a.id,name:a.slug})}})},dt=a=>{f.delete(route("task-attachment.delete",a),{onSuccess:()=>{S.value=S.value.filter(e=>e.id!==a),f.file={},f.clearErrors()}})},ut=()=>{$.value=!0},ct=a=>{M.value=!0,I.value=a},B=()=>{$.value=!1,M.value=!1,O()},j=async a=>await Dt(a).then(e=>{h.value=e.data.nonFollowers,n.value=e.data.task,e.data.task.attachments.forEach(F=>{S.value.push({id:F.id,name:F.slug})}),d.title=e.data.task.title,d.description=e.data.task.description,d.due_date=e.data.task.due_date,d.result=e.data.task.result,d.status=e.data.task.status,d.started_at=e.data.task.started_at,d.assignee_id=e.data.task.assignee_id,d.assigner_id=e.data.task.assigner_id,d.attachments=e.data.task.attachments,d.created_by=e.data.task.assigner_id}),pt=()=>{c.assignee_id=c.assignee.id,c.assigner_id=c.assigner.id,c.post(route("subtask.store"),{onSuccess:()=>{$.value=!1,j(_.taskId),O()}})},mt=()=>{d.post(route("task.close",_.taskId),{onSuccess:()=>{j(_.taskId)}})},_t=()=>{d.post(route("task.reject",_.taskId),{onSuccess:()=>{j(_.taskId)}})},C=a=>["done","closed"].includes(a);return gt(async()=>{await j(_.taskId)}),(a,e)=>{const F=E("tippy"),L=E("ckeditor"),vt=E("icon-file"),bt=kt("tippy");return n.value?(u(),p("div",qt,[t("div",zt,[t("div",Nt,[t("div",Rt,[t("div",Yt,[t("div",Ot,[t("button",{type:"button",class:"absolute ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:e[0]||(e[0]=s=>Y("close"))},[o(H)])]),t("div",Pt,l(n.value.title),1),t("div",null,[t("p",Gt,[t("span",Jt,l(a.$t(`${n.value.status}`)),1)]),t("div",Qt,[n.value.started_at?(u(),p("div",Xt,l(n.value.started_at),1)):(u(),p("div",Kt,[t("button",{type:"button",class:"btn btn-primary",onClick:lt},l(a.$t("start")),1)])),t("div",Wt,[o(st),k(" "+l(n.value.due_date),1)])])]),n.value.status==="done"?(u(),p("div",Zt,[t("button",{type:"button",onClick:e[1]||(e[1]=s=>mt()),class:"btn btn-success"}," Chấp nhận "),t("button",{type:"button",onClick:e[2]||(e[2]=s=>_t()),class:"btn btn-danger"},"Từ chối")])):y("",!0),t("div",te,[t("div",null,[G((u(),p("button",{type:"button",disabled:n.value.started_at===null||C(n.value.status),class:"btn btn-primary",onClick:nt},[k(l(a.$t("mark_as_done")),1)],8,ee)),[[bt,void 0,"hover"]]),o(F,{target:"hover",trigger:"mouseenter"},{default:m(()=>[k(l(a.$t("click_to_mark_done")),1)]),_:1})]),t("div",se,[t("div",null,l(a.$t("assigner"))+" | "+l(a.$t("suppervisor"))+":",1),o(et,{userData:n.value.assigner},null,8,["userData"])])]),t("div",ae,[t("div",oe,[t("label",le,l(a.$t("task_description")),1),x.value?y("",!0):(u(),p("button",{key:0,disabled:C(n.value.status),class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=s=>x.value=!0)},l(a.$t("edit")),9,ne))]),t("div",null,[x.value?(u(),p("div",ie,[o(L,{config:b.value.editorConfig,editor:b.value.editor,modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.description=s)},null,8,["config","editor","modelValue"]),t("div",re,[t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=s=>x.value=!1)},l(a.$t("save")),1),t("button",{type:"button",class:"btn btn-outline-danger",onClick:e[6]||(e[6]=s=>x.value=!1)},l(a.$t("cancel")),1)])])):(u(),p("div",de,[t("div",{innerHTML:n.value.description},null,8,ue)]))])]),t("div",ce,[t("label",pe,l(a.$t("attachments")),1),t("div",null,[t("form",{onChange:rt},[t("div",me,[t("div",_e,[o(vt),e[19]||(e[19]=k(" Browse "))]),t("input",{type:"file",disabled:C(n.value.status),ref:"uploadFile",onInput:e[7]||(e[7]=s=>{var T;return i(f).file=(T=s.target)==null?void 0:T.files[0]}),class:"form-input rounded-l-none"},null,40,ve)]),i(f).progress?(u(),p("div",be,[t("div",fe,[t("div",{class:"bg-success h-1 rounded-full rounded-bl-full text-center text-white text-xs",style:ht({width:i(f).progress.percentage+"%"})},null,4)])])):y("",!0),o(V,{message:i(f).errors.file},null,8,["message"])],32),t("div",ge,[(u(!0),p(q,null,z(S.value,(s,T)=>(u(),p("div",{key:T,class:"flex justify-between col-span-1 mt-2 p-1 border-b-2 hover:border-primary"},[t("a",{href:a.route("task-attachment.download",{id:s.id}),class:"text-sm italic block h-fit underline text-primary hover:font-bold"},[o(Mt,{extension:s.name.split(".").pop(),class:"ml-1"},null,8,["extension"]),k(" "+l(s.name),1)],8,ke),t("span",{class:"text-sm p-1 cursor-pointer hover:text-primary block",onClick:hs=>dt(s.id)},[o(H)],8,he)]))),128))])])]),t("div",ye,[t("label",xe,l(a.$t("task_result")),1),w.value?y("",!0):(u(),p("button",{key:0,class:"btn btn-outline-secondary",onClick:e[8]||(e[8]=s=>w.value=!0),disabled:C(n.value.status)},l(a.$t("update_task_result")),9,we)),w.value?(u(),p("div",$e,[o(L,{config:b.value.editorConfig,modelValue:n.value.result,"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.result=s),editor:b.value.editor},null,8,["config","modelValue","editor"]),o(V,{message:i(d).errors.result},null,8,["message"]),t("div",Se,[t("button",{type:"button",class:"btn btn-primary",onClick:it},l(a.$t("save")),1),t("button",{type:"button",class:"btn btn-outline-danger",onClick:P},l(a.$t("cancel")),1)])])):(u(),p("div",Ce,[t("div",{innerHTML:n.value.result},null,8,Te)]))]),e[20]||(e[20]=t("hr",null,null,-1)),t("div",Ve,[t("label",Ie,l(a.$t("sub_tasks")),1),n.value.sub_tasks?(u(),p("div",De,[(u(!0),p(q,null,z(n.value.sub_tasks,s=>(u(),N(Ht,{sub_task:s,key:s.id,onUpdateSubTask:T=>ct(s.id)},null,8,["sub_task","onUpdateSubTask"]))),128))])):y("",!0),t("button",{class:"btn btn-outline-success",onClick:e[10]||(e[10]=s=>ut()),disabled:C(n.value.status)},l(a.$t("add_subtask")),9,Me)]),e[21]||(e[21]=t("hr",null,null,-1)),t("div",je,[n.value.id?(u(),N(It,{key:0,taskId:n.value.id,users:n.value.followers,onMessageSent:e[11]||(e[11]=s=>at())},null,8,["taskId","users"])):y("",!0)])])])]),t("div",Fe,[o($t,{task:n.value,"non-followers":h.value},null,8,["task","non-followers"])])]),o(i(Z),{appear:"",show:$.value,as:"template"},{default:m(()=>[o(i(X),{as:"div",onClose:e[17]||(e[17]=s=>$.value=!1),class:"relative z-50"},{default:m(()=>[o(i(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>[o(i(K),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),t("div",Ue,[t("div",Be,[o(i(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[o(i(W),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-2xl text-black dark:text-white-dark"},{default:m(()=>[t("button",{type:"button",class:"absolute top-5 ltr:right-5 rtl:left-5 text-white-dark hover:text-dark outline-none",onClick:B},[o(H)]),e[22]||(e[22]=t("div",{class:"text-lg font-semibold ltr:pl-5 rtl:pr-5 py-5 ltr:pr-[50px] rtl:pl-[50px]"}," Thêm nhiệm vụ con ",-1)),t("div",Le,[t("form",{class:"space-y-5",onSubmit:yt(pt,["prevent"])},[t("div",Ae,[t("label",Ee,l(a.$t("title")),1),t("div",He,[t("span",qe,[o(Tt)]),G(t("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=s=>i(c).title=s),placeholder:"Title",class:"form-input ltr:pl-10 rtl:pr-10"},null,512),[[xt,i(c).title]])]),o(V,{message:i(c).errors.title},null,8,["message"])]),t("div",ze,[t("label",Ne,l(a.$t("Deadline")),1),o(i(wt),{class:"form-input",modelValue:i(c).due_date,"onUpdate:modelValue":e[13]||(e[13]=s=>i(c).due_date=s),config:ot.value},null,8,["modelValue","config"]),o(V,{message:i(c).errors.due_date},null,8,["message"])]),t("div",Re,[t("label",Ye,l(a.$t("assigner")),1),t("div",Oe,[t("span",Pe,[o(J)]),o(i(Q),{modelValue:i(c).assigner,"onUpdate:modelValue":e[14]||(e[14]=s=>i(c).assigner=s),options:r.assigners,label:"name","track-by":"id","option-height":104,searchable:!0,placeholder:"Select an user to assign"},{singleLabel:m(s=>[t("div",Ge,[t("img",{class:"h-8 w-8 rounded-full mr-2",src:s.option.avatar,alt:"avatar"},null,8,Je),t("span",Qe,[t("span",Xe,l(s.option.name),1)])])]),option:m(s=>[t("div",Ke,[t("img",{class:"h-8 w-8 rounded-full",src:s.option.avatar,alt:"avatar"},null,8,We),t("div",Ze,[t("span",ts,l(s.option.name),1)])])]),_:1},8,["modelValue","options"])])]),t("div",es,[t("label",ss,l(a.$t("assignee")),1),t("div",as,[t("span",os,[o(J)]),o(i(Q),{modelValue:i(c).assignee,"onUpdate:modelValue":e[15]||(e[15]=s=>i(c).assignee=s),options:r.assignees,label:"name","track-by":"id","option-height":104,searchable:!0,placeholder:"Select an user to assign"},{singleLabel:m(s=>[t("div",ls,[t("img",{class:"h-8 w-8 rounded-full mr-2",src:s.option.avatar,alt:"avatar"},null,8,ns),t("span",is,[t("span",rs,l(s.option.name),1)])])]),option:m(s=>[t("div",ds,[t("img",{class:"h-8 w-8 rounded-full",src:s.option.avatar,alt:"avatar"},null,8,us),t("div",cs,[t("span",ps,l(s.option.name),1)])])]),_:1},8,["modelValue","options"])])]),t("div",ms,[t("label",_s,l(a.$t("task_description")),1),o(L,{config:b.value.editorConfig,modelValue:i(c).description,"onUpdate:modelValue":e[16]||(e[16]=s=>i(c).description=s),editor:b.value.editor},null,8,["config","modelValue","editor"]),o(V,{message:i(c).errors.description},null,8,["message"])]),t("div",vs,[t("button",{type:"button",class:"btn btn-outline-danger w-full",onClick:B},l(a.$t("cancel")),1),t("button",bs,l(a.$t("save")),1)])],32)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),o(i(Z),{appear:"",show:M.value,as:"template"},{default:m(()=>[o(i(X),{as:"div",onClose:e[18]||(e[18]=s=>M.value=!1),class:"relative z-50"},{default:m(()=>[o(i(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>[o(i(K),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),t("div",fs,[t("div",gs,[o(i(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[o(i(W),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-3xl text-black dark:text-white-dark"},{default:m(()=>[o(Ct,{subtask_id:I.value,onClose:B},null,8,["subtask_id"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])):(u(),p("div",ks,e[23]||(e[23]=[t("span",{class:"animate-spin border-4 border-primary border-l-transparent rounded-full w-10 h-10"},null,-1)])))}}});export{st as I,Bt as _,Us as a};
